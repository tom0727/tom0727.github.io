+++
title = '斜率优化DP'
date = 2022-09-21T14:47:44-05:00
draft = false
categories = ['算法']
tags = ['DP', '斜率优化DP']
+++

## 介绍

斜率DP一般用于解决类似于如下的问题：

$$dp[i] = \min\limits_{j<i} \\{ g(j) + f(i, j) + h(i)\\}$$

• 注意到上述式子中，当我们固定 $i$，仅有的变量为 $j$，需要最小化的是 $g(j) + f(i, j)$。

一个经典的例子是：

$$dp[i] - (s_i - L')^2 = \min\limits_{j < i} \\{dp[j] + s_j^2 + 2s_j(L' - s_i)\\}$$

在这个式子中，$L'$ 是一个定值，$s_i$ 代表 $sum[i] + i$，所以对于固定的 $i$，$(s_i - L')^2$ 也是一个定值，所以变量也就只有 $j$，如何快速找到这样的 $j$ 是斜率优化DP要解决的问题。

<hr>

对于这一类问题，我们列出式子 $y=kx+b$，也就是 $b=y-kx$。

一般来说，变量的意义如下：

{{% center %}}

$b$：需要最大化/最小化的项，一般形式为 $dp[i] + h(i)$

$y$：仅包含 $j$ 的项，一般形式为 $g(j)$

$kx$：包含 $i,j$ 的项，一般形式为 $f(i,j)$，其中 $x$ 需要**单调递增**，并且一般 $x$ 是 $f(i,j)$ 中代表 $j$ 的部分，$k$ 是 $f(i,j)$ 中代表 $i$ 的部分。

{{% /center %}}

<hr>

假设我们要最小化 $b$ 的值，那么需要直线 $y=kx+b$ 的截距最小。

那么根据上述式子，我们令

$$b_i = dp[i] - (s_i - L')^2$$

$$y_j = dp[j] + s_j^2$$

$$k_i=-2(L'-s_i)$$

$$x_j = s_j$$

转移方程就有

$$b_i=\min\limits_{j<i} \\{ y_j - k_ix_j \\}$$

![img](/images/073/1.png)

如果我们把 $(x_j,y_j)$ 看作二维平面上的点，则 $k_i$ 就是斜率，$b_i$ 代表一条过 $(x_j,y_j)$ 的斜率为 $k_i$ 的直线的截距，那么问题转化为选择合适的点 $j$，最小化截距。

我们发现，在求 **最小值** 的情况下，只有那些在这个点集中的 **下凸包** 上的点，才有可能作为最优的 $j$。

具体是哪个点呢？

我们发现，如果将直线 $y=kx+b$ **从下往上移动，第一个碰到的点** $j$ 就是最优决策点。

{{% center %}}

![img](/images/073/2.PNG)

{{% /center %}}

从图中可以发现，这个最优决策点 $j$ 一定满足条件：它是**最小**的 $j$，使得直线 $(j,j+1)$ 的斜率 $>k$。

由于下凸包中，$\forall i < j$，直线 $(i, i+1)$ 的斜率一定**小于**直线 $(j,j+1)$ 的斜率，所以这样的 $j$ 可以用**二分**找到。

不过这道题更简单，因为 $k_i$ 随着 $i$ 的增加而单调递减，所以用**单调队列**维护凸包即可。

最后看下如何用单调队列维护一个点集的**下凸包**：

只要在插入一个新的点 $i$ 时，判断是否满足以下条件：

1. 插入前，队列里至少有两个元素
2. $k(q_{r-1}, q_r) > k(q_r, i)$

那么就一直pop队尾，直到上述两个条件之一不满足即可。